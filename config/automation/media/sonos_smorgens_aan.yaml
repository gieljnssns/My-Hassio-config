alias: "sonos smorgens aan"
id: 845eafa5-a0f1-4c17-93d0-a7b84d5a5e9a
trigger:
  - platform: state
    entity_id: binary_sensor.beweging_keuken_camera
    from: "off"
    to: "on"
condition:
  condition: and
  conditions:
    - condition: time
      after: "08:00:00"
      before: "12:30:00"
    - condition: state
      entity_id: binary_sensor.keuken_not_playing
      state: "on" # {{ states('media_player.keuken') != 'playing' }}
      for:
        hours: 5
    - condition: state
      entity_id: input_boolean.giel_slaapt_na_nacht
      state: "off"
    - condition: or
      conditions:
        - condition: state
          entity_id: binary_sensor.schooldag
          state: "on"
        - condition: template
          value_template: >
            {% if states.calendar.monnikenheide_monnikenheide.attributes.start_time is defined %}
              {{as_timestamp(states.calendar.monnikenheide_monnikenheide.attributes.start_time) - as_timestamp(as_local(states.sensor.time.last_changed)) | float < 26.640}}
            {% else %}
              False
            {% endif %}
        - condition: template
          value_template: >
            {% if states.calendar.mondelez_de_vroege.attributes.start_time is defined %}
              {{as_timestamp(states.calendar.mondelez_de_vroege.attributes.start_time) - as_timestamp(as_local(states.sensor.time.last_changed)) | float < 108000}}
            {% else %}
              False
            {% endif %}
        - condition: template
          value_template: >
            {% if states.calendar.mondelez_de_late.attributes.start_time is defined %}
              True
            {% else %}
              False
            {% endif %}
    - condition: or
      conditions:
        - condition: state
          entity_id: device_tracker.giel_not_so_binary
          state: "Thuis"
        - condition: state
          entity_id: device_tracker.martine_not_so_binary
          state: "Thuis"
action:
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.keuken
      volume_level: 0.12
  - service: media_player.select_source
    data_template:
      entity_id: media_player.keuken
      source: >
        {{ [
          'Willy',
          'Arrow Classic Rock',
          'Black Label Extreme Metal Radio',
          'VRT Studio Brussel Bruut',
          'Hard Rock Hell Radio',
          'New Lords of Metal',
          'Punk Riot',
          'Brutale Belgen 🇧🇪💪🏻☠️',
          'MetalRock.FM',
          'VRT Studio Brussel Bruut',
          'Hand of Doom Radio',
          'Real Punk Radio',
          'Het betere genre',
          'Brutale Belgen 🇧🇪💪🏻☠️',
          'Het betere genre +',
          'Punk In Drublic',
          'VRT Studio Brussel Bruut',
          'Pinguin Aardschok',
          'Pinguin On The Rocks',
          'Belgische gitaren�',
          'GARAGE BANGERS!',
          "PUNK!!! Let's go!!",
          'VAN EIGEN BODEM! (Belgische Gitaren)'
        ] | random }}
