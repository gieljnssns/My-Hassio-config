alias: Warmtepomp warm water
id: 8766541b-6bb2-4bc8-87af-f29e0accd997
description: ''
mode: single
trigger:
  - platform: numeric_state
    entity_id: sensor.l2_net_terugsturen
    above: 600
    for:
      minutes: 5
  - platform: state
    entity_id: binary_sensor.douchen
    to: 'on'
condition:
  - condition: state
    entity_id: input_boolean.op_verlof
    state: 'off'
  - condition: numeric_state
    entity_id: sensor.thermostaat
    below: 46
  - condition: template
    value_template: >
      {{  states("input_boolean.warm_water_5u") == "off" and states("input_boolean.warm_water_2u") == "off" }}
action:
  - choose:
      - conditions:
          - alias: "Niet op verlof"
            condition: state
            entity_id: input_boolean.op_verlof
            state: "off"
          - condition: template
            value_template: >-
              {{ (states("sensor.solcast_solaredge_forecast") | float(default=0)+
                  states("sensor.solcast_huawei_forecast") | float(default=0)) | round(2) > 20 | float(default=0)}}
        sequence:
          - service: input_boolean.turn_on
            target:
              entity_id: input_boolean.warm_water_5u
    default:
      - condition: time
        before: "22:00:00"
      - condition: time
        after: "08:00:00"
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.warm_water_2u
