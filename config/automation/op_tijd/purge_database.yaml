alias: "Purge database"
id: ca43a372-7850-436b-94e5-5024377653be
trigger:
  - platform: time
    at: "03:12:00"
  - platform: time
    at: "04:12:00"
variables:
  a: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 0 %}
    {%- set b = part * 1 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  b: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 1 %}
    {%- set b = part * 2 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  c: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 2 %}
    {%- set b = part * 3 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  d: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 3 %}
    {%- set b = part * 4 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  e: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 4 %}
    {%- set b = part * 5 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  f: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 5 %}
    {%- set b = part * 6 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  g: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 6 %}
    {%- set b = part * 7 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  h: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 7 %}
    {%- set b = part * 8 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  i: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 8 %}
    {%- set b = part * 9 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  j: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 9 %}
    {%- set b = part * 10 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  k: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 10 %}
    {%- set b = part * 11 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  l: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 11 %}
    {%- set b = part * 12 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  m: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 12 %}
    {%- set b = part * 13 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  n: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 13 %}
    {%- set b = part * 14 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  o: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 14 %}
    {%- set b = part * 15 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  p: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 15 %}
    {%- set b = part * 16 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  q: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 16 %}
    {%- set b = part * 17 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  r: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 17 %}
    {%- set b = part * 18 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  s: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 18 %}
    {%- set b = part * 19 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  t: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 19 %}
    {%- set b = part * 20 %}
    {{ state_attr("sensor.purge_entites", "list")[a:] }}
  aa: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 20 %}
    {%- set b = part * 21 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  bb: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 21 %}
    {%- set b = part * 22 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  cc: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 22 %}
    {%- set b = part * 23 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  dd: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 23 %}
    {%- set b = part * 24 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  ee: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 24 %}
    {%- set b = part * 25 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  ff: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 25 %}
    {%- set b = part * 26 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  gg: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 26 %}
    {%- set b = part * 27 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  hh: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 27 %}
    {%- set b = part * 28 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  ii: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 28 %}
    {%- set b = part * 29 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  jj: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 29 %}
    {%- set b = part * 30 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  kk: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 30 %}
    {%- set b = part * 31 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  ll: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 31 %}
    {%- set b = part * 22 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  mm: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 32 %}
    {%- set b = part * 33 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  nn: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 33 %}
    {%- set b = part * 34 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  oo: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 34 %}
    {%- set b = part * 35 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  pp: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 35 %}
    {%- set b = part * 36 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  qq: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 36 %}
    {%- set b = part * 37 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  rr: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 37 %}
    {%- set b = part * 38 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  ss: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 38 %}
    {%- set b = part * 39 %}
    {{ state_attr("sensor.purge_entites", "list")[a:b] }}
  tt: >
    {%- set part = (states("sensor.purge_entites") | float / 40) | int %}
    {%- set a = part * 39 %}
    {%- set b = part * 30 %}
    {{ state_attr("sensor.purge_entites", "list")[a:] }}
action:
  - choose:
      - conditions:
          - condition: template
            value_template: >
              {{ now().hour == 3 }}
        sequence:
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ a }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ b }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ c }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ d }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ e }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ f }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ g }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ h }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ i }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ j }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ k }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ l }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ m }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ n }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ o }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ p }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ q }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ r }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ s }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ t }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ aa }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ bb }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ cc }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ dd }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ ee }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ ff }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ gg }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ hh }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ ii }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ jj }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ kk }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ ll }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ mm }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ nn }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ oo }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ pp }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ qq }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ rr }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ ss }}
          - delay:
              seconds: 45
          - service: recorder.purge_entities
            data:
              keep_days: 7
              entity_id: >
                {{ tt }}
    default:
      - service: recorder.purge
        data:
          keep_days: 365
          repack: true
